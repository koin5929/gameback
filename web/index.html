<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>람쥐 서버 | 힐링 야생 RPG 공식 홈페이지</title>

  <!-- Indexing -->
  <meta name="robots" content="index,follow,max-image-preview:large" />
  <link rel="canonical" href="https://ramji.o-r.kr/" />
  <link rel="alternate" hreflang="ko" href="https://ramji.o-r.kr/" />

  <!-- SEO -->
  <meta name="description" content="람쥐 서버 — 힐링 야생과 RPG가 만나는 마인크래프트 서버. 레이드/제작 아이템/시즌 패스. 디스코드 연동 사전예약 지원. 버전 1.21.4 · 서버 주소 lconlin.kro.kr." />
  <meta name="keywords" content="람쥐 서버, 힐링 야생, RPG, 마인크래프트 서버, 레이드, 마크 서버추천, 마인크래프트 서버추천, 마크rpg서버, 마인크래프트rpg서버, 마크rpg서버추천, 마인크래프트rpg서버추천, 마크힐링서버, 마크힐링서버추천, 마인크래프트 힐링서버, 마인크래프트 힐링서버 추천, 마인크래프트 힐링rpg, 마크 악어의놀이터, 마크악놀서버, 악놀서버, 사전예약, 디스코드 연동, 보스 레이드" />
  <meta name="naver-site-verification" content="39822cdde872321108efb7ad4d7b769c53908351" />
  <meta name="google-site-verification" content="Lnp3TGxnzm5d5fjc4utHiSN-Ggz248sPH8Y4nQDfqEM" />

  <!-- Open Graph / Twitter -->
  <meta property="og:site_name" content="람쥐 서버" />
  <meta property="og:title" content="람쥐 서버 | 힐링 야생 RPG" />
  <meta property="og:description" content="오직 람쥐 서버에서만 경험할 수 있는 힐링 야생 RPG. 지금 디스코드 참여 & 사전예약!" />
  <meta property="og:image" content="https://ramji.o-r.kr/assets/ramjwi_logo.png" />
  <meta property="og:url" content="https://ramji.o-r.kr/" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ko_KR" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="람쥐 서버 | 힐링 야생 RPG" />
  <meta name="twitter:description" content="힐링 야생·RPG·레이드. 디스코드 연동 사전예약!" />
  <meta name="twitter:image" content="https://ramji.o-r.kr/assets/ramjwi_logo.png" />

  <!-- Icons -->
  <link rel="icon" type="image/png" href="assets/ramjwi_logo.png" />
  <link rel="apple-touch-icon" href="assets/ramjwi_logo.png" />

  <!-- Fonts & CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Marcellus&family=Noto+Sans+KR:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <style>html{scroll-behavior:smooth}</style>

  <!-- JSON-LD: Organization & Website -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "람쥐 서버",
    "url": "https://ramji.o-r.kr/",
    "logo": "https://ramji.o-r.kr/assets/ramjwi_logo.png",
    "sameAs": ["https://discord.gg/BpYQUyhrAc"]
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "람쥐 서버",
    "url": "https://ramji.o-r.kr/",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://ramji.o-r.kr/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="#home" class="brand">
        <img src="assets/ramjwi_logo.png" alt="람쥐 서버 로고" class="brand-logo" />
        <span class="brand-title">람쥐 서버</span>
      </a>

      <nav class="nav" id="siteNav" aria-label="주요">
        <a href="#home">홈</a>
        <a href="#about">서버 소개</a>
        <a href="#guide">시작 가이드</a>
        <a href="#bingo">빙고 포인트</a>
        <a href="#news">소식</a>
        <a href="https://discord.gg/BpYQUyhrAc" target="_blank" rel="noopener">디스코드</a>
        <a href="#reserve" class="btn btn--gold">사전예약</a>
      </nav>

      <!-- Auth area (Discord OAuth) -->
      <div id="authArea" class="auth"></div>

      <button class="hamburger" aria-controls="siteNav" aria-expanded="false" aria-label="메뉴 열기">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <!-- Hero -->
  <section id="home" class="hero">
    <div class="hero-bg">
      <img src="wood.svg" alt="" aria-hidden="true">
    </div>
    <div class="container hero-inner">
      <p class="badge">힐링 야생 RPG</p>
      <h1>오직 람쥐 서버에서만 경험할 수 있는<br><span class="accent">힐링·성장·모험</span></h1>
      <p class="lead">여유로운 야생의 일상과 RPG의 짜릿한 보스 레이드가 만나는 곳. 함께 만들고 함께 노는, 우리만의 월드.</p>

      <div class="hero-cta">
        <a class="btn btn--primary" href="https://discord.gg/BpYQUyhrAc" target="_blank" rel="noopener">디스코드 참여</a>
        <a class="btn btn--ghost" href="#reserve">사전예약</a>
      </div>

      <div class="server-chip" role="group" aria-label="서버 접속 정보">
        <div class="chip">
          <span class="chip-title">버전</span>
          <strong>1.21.4</strong>
        </div>
        <div class="chip">
          <span class="chip-title">서버 주소</span>
          <code id="server-ip">lconlin.kro.kr</code>
          <button class="copy" data-copy="#server-ip" aria-label="서버 주소 복사">복사</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Features -->
  <section class="section" id="features">
    <div class="container">
      <h2 class="section-title">왜 람쥐 서버인가요?</h2>
      <div class="grid features">
        <article class="card">
          <h3>힐링 야생</h3>
          <p>채집·건축·낚시로 여유를 즐기고, 커뮤니티 중심의 소셜 플레이를 권장합니다.</p>
        </article>
        <article class="card">
          <h3>RPG 성장</h3>
          <p>장비 티어, 제작 아이템, 일일 퀘스트·패스로 꾸준히 성장하세요.</p>
        </article>
        <article class="card">
          <h3>보스 레이드</h3>
          <p>층별 공략이 있는 던전 시스템. 스켈레톤 왕부터 유령 기사까지 단계별 도전!</p>
        </article>
        <article class="card">
          <h3>안정적인 운영</h3>
          <p>지속적인 업데이트 로드맵과 활발한 디스코드 운영으로 오래 가는 서버를 지향합니다.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- About -->
  <section class="section" id="about">
    <div class="container">
      <h2 class="section-title">서버 소개</h2>
      <p class="intro">
        람쥐 서버는 “야생의 자유”와 “RPG의 목적성”을 결합한 하이브리드 플레이를 제공합니다.
        누구나 가볍게 시작해도, 던전과 레이드, 제작과 경제를 통해 진지하게 파고들 수 있는 구조로 설계되었습니다.
        적정 난이도와 깔끔한 밸런스를 바탕으로, <strong>‘편안하지만 심심하지 않은’</strong> 경험을 선사합니다.
      </p>

      <div class="grid two">
        <div>
          <h3>핵심 시스템</h3>
          <ul class="check">
            <li>제작 아이템/장비 티어(가죽→사슬→철→금→다이아)</li>
            <li>던전 레이드(3단계 보스 라인업)</li>
            <li>일일퀘스트 & 시즌 패스</li>
            <li>야생 던전 & 오픈 월드 탐험</li>
          </ul>
        </div>
        <div>
          <h3>레이드 프리뷰</h3>
          <ul class="boss">
            <li><strong>1단계</strong> 스켈레톤 왕 — HP 222 / AT 5</li>
            <li><strong>2단계</strong> 스켈레톤 왕(강화) — HP 444 / AT 7</li>
            <li><strong>3단계</strong> 유령 기사 — HP 777 / AT 9</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- Guide -->
  <section class="section" id="guide">
    <div class="container">
      <h2 class="section-title">시작 가이드</h2>
      <ol class="steps">
        <li><span>①</span> <a href="https://discord.gg/BpYQUyhrAc" target="_blank" rel="noopener">디스코드 참여</a> 후 공지 확인</li>
        <li><span>②</span> <a href="#reserve">사전예약</a>을 완료해 시작 보상 예약</li>
        <li><span>③</span> 게임에서 <code>lconlin.kro.kr</code> 접속 (버전 1.21.4)</li>
        <li><span>④</span> 첫 퀘스트와 튜토리얼로 월드에 적응</li>
      </ol>
      <div class="note">사전예약 시 <strong>‘시작의 치장 세트’</strong> 지급: 낚싯대 스킨 + 시작의 모자</div>
    </div>
  </section>

  <!-- News -->
  <section class="section" id="news">
    <div class="container">
      <h2 class="section-title">소식 & 공지</h2>
      <div class="grid news">
        <article class="card">
          <h3>오픈 전 이벤트</h3>
          <p>사전 후원 시 <strong>+20%</strong> 보너스 제공! 디스코드 공지에서 상세 조건을 확인하세요.</p>
        </article>
        <article class="card">
          <h3>사전예약 보상</h3>
          <p>사전예약만 하면 <strong>시작의 치장 세트</strong> 지급: 낚싯대 스킨 + 시작의 모자.</p>
        </article>
        <article class="card">
          <h3>디스코드 활동 보상</h3>
          <p>디스코드 채팅 레벨 10 달성 시 <strong>아이콘 칭호</strong>를 드립니다.</p>
        </article>
      </div>
    </div>
  </section>

  <!-- Reserve with integrated auth/list -->
  <section class="section" id="reserve">
    <div class="container">
      <h2 class="section-title">사전예약</h2>

      <div class="grid two">
        <div class="card">
          <h3>내 예약 상태</h3>
          <div id="meBox" class="mebox muted">로그인하면 예약 상태를 표시합니다.</div>
          <p class="small muted">※ 사전예약은 디스코드 서버 내 <b>/사전예약패널</b> → <b>사전 예약하기</b> 버튼으로 진행됩니다.</p>
        </div>

        <div class="card">
          <h3>서버 정보 확인</h3>
          <p class="muted">서버 정보 확인은 <strong>디스코드에서 확인 가능합니다</strong>.</p>
          <a class="btn btn--primary" href="https://discord.gg/BpYQUyhrAc" target="_blank" rel="noopener">디스코드 바로가기</a>
        </div>
      </div>

      <div class="card" style="margin-top:16px;">
        <div class="list-head">
          <h3>사전예약 명단</h3>
          <div class="list-head-tools row">
            <label class="muted small">정렬</label>
            <select id="sortBy">
              <option value="latest">최신 등록순</option>
              <option value="oldest">오래된 등록순</option>
              <option value="nick">닉네임 A→Z</option>
              <option value="mc">마크닉 A→Z</option>
            </select>
            <label class="muted small">페이지</label>
            <select id="pageSize">
              <option value="10">10</option>
              <option value="20" selected>20</option>
              <option value="50">50</option>
            </select>
            <input id="searchInput" class="search" placeholder="닉네임 검색">
          </div>
        </div>
        <ul id="list" class="list"><li class="muted">불러오는 중.</li></ul>
        <div class="pager row">
          <button class="btn btn--ghost" id="prevBtn">이전</button>
          <span id="pageInfo" class="muted small">1 / 1</span>
          <button class="btn btn--ghost" id="nextBtn">다음</button>
        </div>
      </div>

      <div class="reserve-cta" style="margin-top:16px;">
        <a class="btn btn--primary" href="https://discord.gg/BpYQUyhrAc" target="_blank" rel="noopener">디스코드에서 예약하기</a>
        <a class="btn btn--ghost" href="#guide">시작 가이드 보기</a>
      </div>
    </div>
  </section>

  <!-- Bingo Section -->
  <section class="section" id="bingo" style="background: linear-gradient(135deg, #1a0f1a 0%, #0d0a15 50%, #1a0f1a 100%); position: relative; overflow: hidden;">
    <div style="position: absolute; inset: 0; background: radial-gradient(circle at 30% 50%, rgba(209,169,84,0.15), transparent 70%); pointer-events: none;"></div>
    <div class="container" style="position: relative; z-index: 1;">
      <div style="text-align: center; margin-bottom: 48px;">
        <span class="badge" style="font-size: 14px; padding: 8px 16px;">🎁 포인트 보상 시스템</span>
        <h2 class="section-title" style="margin-top: 16px; background: linear-gradient(135deg, #ffd57e, #D1A954, #ffd57e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">빙고 포인트 챌린지</h2>
        <p style="color: var(--muted); max-width: 700px; margin: 16px auto; font-size: 18px;">서버에서 플레이하고 포인트를 모아<br>81칸의 빙고판에서 신비한 보상을 선택하세요!</p>
      </div>

      <!-- Login/Auth Section -->
      <div class="card" style="margin-bottom: 32px; background: linear-gradient(135deg, rgba(209,169,84,0.1), rgba(209,169,84,0.05)); border: 2px solid var(--gold);">
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px; flex-wrap: wrap;">
          <div id="bingoAuth">
            <h3 style="margin: 0 0 8px; color: var(--gold-2);">마인크래프트 계정 연동</h3>
            <p style="margin: 0; color: var(--muted); font-size: 14px;">마인크래프트 닉네임을 입력하여 포인트를 확인하세요</p>
          </div>
          <div style="display: flex; gap: 12px; flex-wrap: wrap;">
            <input type="text" id="mcNickInput" placeholder="마인크래프트 닉네임" style="padding: 12px 16px; border-radius: 12px; background: rgba(15,15,15,0.5); border: 1px solid var(--border); color: white; min-width: 200px;">
            <button onclick="linkMinecraft()" class="btn btn--gold" style="white-space: nowrap;">연동하기</button>
          </div>
        </div>
      </div>

      <!-- Points Display -->
      <div id="pointsInfo" style="display: none; margin-bottom: 32px;">
        <div class="card" style="background: linear-gradient(135deg, var(--gold-2), var(--gold)); padding: 24px; display: flex; align-items: center; gap: 24px; border: none; box-shadow: 0 8px 24px rgba(209,169,84,0.3);">
          <div style="font-size: 48px;">💰</div>
          <div style="flex: 1;">
            <div style="font-size: 14px; opacity: 0.8; margin-bottom: 4px;">보유 포인트</div>
            <div style="font-size: 36px; font-weight: 900; color: #000;">개 포인트</div>
            <div style="font-size: 14px; opacity: 0.7; margin-top: 4px;">30분 플레이 = 1포인트</div>
          </div>
          <div id="pointsValue" style="font-size: 56px; font-weight: 900; color: #000;">0</div>
        </div>
      </div>

      <!-- Bingo Grid -->
      <div class="card" style="padding: 32px; background: rgba(15,15,15,0.8); backdrop-filter: blur(10px);">
        <div style="margin-bottom: 24px;">
          <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px;">
            <h3 style="margin: 0; color: var(--gold-2);">빙고판 (9x9)</h3>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <span class="badge" style="background: rgba(255,72,192,0.2); color: #ff48c0; border-color: #ff48c0;">S+ 1개</span>
              <span class="badge" style="background: rgba(255,165,0,0.2); color: #ffa500; border-color: #ffa500;">S 3개</span>
              <span class="badge" style="background: rgba(255,215,0,0.2); color: #ffd700; border-color: #ffd700;">A 6개</span>
              <span class="badge" style="background: rgba(100,200,255,0.2); color: #64c8ff; border-color: #64c8ff;">B 18개</span>
              <span class="badge" style="background: rgba(150,150,255,0.2); color: #9696ff; border-color: #9696ff;">C 27개</span>
              <span class="badge" style="background: rgba(200,200,200,0.2); color: #c8c8c8; border-color: #c8c8c8;">D 26개</span>
            </div>
          </div>
        </div>

        <div id="bingoGrid" style="display: grid; grid-template-columns: repeat(9, 1fr); gap: 8px; max-width: 900px; margin: 0 auto;">
          <!-- 빙고칸들이 여기에 동적으로 추가됩니다 -->
        </div>

        <div style="margin-top: 24px; text-align: center; color: var(--muted); font-size: 14px;">
          💡 포인트를 사용하여 빙고 칸을 선택하세요. 3포인트 = 1칸 선택 가능
        </div>
      </div>

      <!-- Selected Items Display -->
      <div id="selectedItems" style="display: none; margin-top: 32px;">
        <div class="card">
          <h3 style="margin: 0 0 16px;">내가 선택한 보상</h3>
          <div id="selectedList" class="list"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-brand">
        <img src="assets/ramjwi_logo.png" alt="" aria-hidden="true">
        <div>
          <strong>람쥐 서버</strong>
          <div class="muted">© <span id="year"></span> Ramjwi Server. All rights reserved.</div>
        </div>
      </div>
      <nav class="footer-nav">
        <a href="#about">서버 소개</a>
        <a href="#guide">시작 가이드</a>
        <a href="#news">소식</a>
        <a href="https://discord.gg/BpYQUyhrAc" target="_blank" rel="noopener">디스코드</a>
      </nav>
    </div>
  </footer>

  <script>
    // ---- API endpoints (must exist on backend) ----
    const api = {
      list: "/api/list",
      me: "/api/me",
      validate: (name) => `/api/validate-name?name=${encodeURIComponent(name)}`,
      login: "/auth/login",
      logout: "/auth/logout",
    };

    const el = (q) => document.querySelector(q);

    async function fetchJSON(url){
      const r = await fetch(url, { credentials: "include" });
      if(!r.ok) throw new Error("fetch failed");
      return await r.json();
    }

    // ---- Auth & Me Box ----
    async function loadAuth(){
      const area = el("#authArea");
      try{
        const me = await fetchJSON(api.me);
        if(me && me.ok){
          const p = me.user || {};
          area.innerHTML = `
            <div class="auth">
              <img class="avatar" src="https://cdn.discordapp.com/avatars/${p.id}/${p.avatar}.png?size=64" onerror="this.style.display='none'" alt="avatar">
              <div class="who">
                <div class="name">${p.global_name || p.username}</div>
                <a class="link" href="${api.logout}">로그아웃</a>
              </div>
            </div>`;

          const box = el("#meBox");
          if(me.reserved){
            const r = me.reserved;
            box.innerHTML = `
              <div class="me">
                <div class="state ok">✅ 사전예약 완료</div>
                <div class="rows">
                  <div><span class="label">닉네임</span><span><b>${me.user.global_name || me.user.username}</b></span></div>
                  <div><span class="label">마크 닉네임</span><span><b>${r.mc_name}</b></span></div>
                  <div><span class="label">등록 시각</span><span>${fmtTime(r.created_at)}</span></div>
                </div>
              </div>`;
          }else{
            box.innerHTML = `
              <div class="me">
                <div class="state warn">⏳ 아직 사전예약 전</div>
                <div class="rows">
                  <div><span class="label">안내</span><span>디스코드에서 <b>/사전예약패널</b> → <b>사전 예약하기</b> 버튼으로 신청하세요.</span></div>
                </div>
              </div>`;
          }
        }else{
          area.innerHTML = `<a class="btn btn--gold" href="${api.login}">Discord로 로그인</a>`;
          el("#meBox").innerHTML = `로그인하면 내 예약 상태를 확인할 수 있습니다.`;
        }
      }catch(e){
        el("#authArea").innerHTML = `<span class="muted small">인증 정보를 불러올 수 없습니다.</span>`;
      }
    }

    function fmtTime(t){
      try{
        const d = new Date(t);
        const pad = (n)=> String(n).padStart(2,"0");
        return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())} ${pad(d.getHours())}:${pad(d.getMinutes())}`;
      }catch(_){ return String(t); }
    }

    // ---- List with sort/filter/pagination ----
    let rawList = [];
    let filtered = [];
    let current = 1;
    let pageSize = 20;
    const sortSel = ()=> el("#sortBy");
    const pageInfo = ()=> el("#pageInfo");

    function sortData(arr){
      const v = sortSel().value;
      const a = [...arr];
      if(v === "latest"){
        a.sort((x,y)=> new Date(y.created_at) - new Date(x.created_at));
      }else if(v === "oldest"){
        a.sort((x,y)=> new Date(x.created_at) - new Date(y.created_at));
      }else if(v === "nick"){
        a.sort((x,y)=> (x.nickname||"").localeCompare(y.nickname||""));
      }else if(v === "mc"){
        a.sort((x,y)=> (x.mc_name||"").localeCompare(y.mc_name||""));
      }
      return a;
    }
    function applyFilter(){
      const q = el("#searchInput").value.trim().toLowerCase();
      filtered = sortData(
        rawList.filter(x => {
          const a = (x.nickname||"").toLowerCase();
          const b = (x.mc_name||"").toLowerCase();
          return !q || a.includes(q) || b.includes(q);
        })
      );
      current = 1;
      renderPage();
    }
    function renderPage(){
      const total = filtered.length;
      const pages = Math.max(1, Math.ceil(total / pageSize));
      if(current > pages) current = pages;
      const start = (current-1)*pageSize;
      const pageItems = filtered.slice(start, start+pageSize);

      const ul = el("#list");
      if(!pageItems.length){
        ul.innerHTML = `<li class="muted">명단이 비었거나 조건에 맞는 결과가 없습니다.</li>`;
      }else{
        ul.innerHTML = pageItems.map(x => `
          <li class="li">
            <div class="nick">${x.nickname}</div>
            <div class="sub muted">(MC: ${x.mc_name})</div>
            <div class="time badge">${fmtTime(x.created_at)}</div>
          </li>
        `).join("");
      }
      pageInfo().textContent = `${current} / ${pages}`;
    }

    async function loadList(){
      try{
        rawList = await fetchJSON(api.list);
        applyFilter();
      }catch(e){
        el("#list").innerHTML = `<li class="muted">불러오기 실패</li>`;
      }
    }

    // Events
    document.addEventListener("input", (ev)=>{
      if(ev.target && ev.target.id === "searchInput") applyFilter();
    });
    document.addEventListener("change", (ev)=>{
      if(ev.target && ev.target.id === "sortBy") applyFilter();
    });
    document.addEventListener("click", (ev)=>{
      if(ev.target && ev.target.id === "prevBtn"){ if(current>1){ current--; renderPage(); } }
      if(ev.target && ev.target.id === "nextBtn"){ current++; renderPage(); }
    });

    // Mobile nav
    const hamburger = document.querySelector('.hamburger');
    const nav = document.getElementById('siteNav');
    hamburger.addEventListener('click', () => {
      const expanded = hamburger.getAttribute('aria-expanded') === 'true';
      hamburger.setAttribute('aria-expanded', String(!expanded));
      nav.classList.toggle('is-open');
      document.body.classList.toggle('no-scroll');
    });
    // Close mobile nav on link click
    document.querySelectorAll('#siteNav a').forEach(a => {
      a.addEventListener('click', () => {
        nav.classList.remove('is-open');
        hamburger.setAttribute('aria-expanded', 'false');
        document.body.classList.remove('no-scroll');
      });
    });

    // Copy server IP
    const copyBtns = document.querySelectorAll('.copy');
    copyBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const sel = btn.getAttribute('data-copy');
        const elx = document.querySelector(sel);
        const text = elx ? elx.textContent.trim() : '';
        navigator.clipboard.writeText(text).then(() => {
          const old = btn.textContent;
          btn.textContent = '복사됨!';
          btn.classList.add('copied');
          setTimeout(() => { btn.textContent = '복사'; btn.classList.remove('copied'); }, 1400);
        });
      });
    });

    // ========== BINGO SYSTEM ==========
    let currentUUID = null;
    let bingoItems = [];
    let playerBingo = [];
    let userPoints = 0;

    async function linkMinecraft() {
      const nick = document.getElementById("mcNickInput").value.trim();
      if (!nick || nick.length < 3 || nick.length > 16) {
        alert("올바른 마인크래프트 닉네임을 입력하세요 (3-16자)");
        return;
      }
      
      try {
        const resp = await fetch(`/api/validate-name?name=${encodeURIComponent(nick)}`);
        const data = await resp.json();
        
        if (!data.ok || !data.uuid) {
          alert("존재하지 않는 마인크래프트 닉네임입니다.");
          return;
        }
        
        currentUUID = data.uuid;
        localStorage.setItem("mcUUID", currentUUID);
        localStorage.setItem("mcName", data.name);
        
        // 포인트 조회
        await loadPoints();
        
        // 빙고판 로드
        await loadBingo();
        
        // UI 업데이트
        document.getElementById("bingoAuth").innerHTML = `
          <h3 style="margin: 0 0 8px; color: var(--gold-2);">✅ ${data.name} (${data.uuid})</h3>
          <p style="margin: 0; color: var(--muted); font-size: 14px;">연동 완료!</p>
        `;
        
        document.getElementById("pointsInfo").style.display = "block";
        
      } catch (e) {
        alert("연동 실패: " + e.message);
      }
    }

    async function loadPoints() {
      if (!currentUUID) return;
      
      try {
        const resp = await fetch(`/api/points/${currentUUID}`);
        const data = await resp.json();
        userPoints = data.points;
        document.getElementById("pointsValue").textContent = data.points;
        
        // 포인트 업데이트 후 빙고판 다시 렌더링
        if (bingoItems.length > 0) {
          renderBingoGrid();
        }
      } catch (e) {
        // 에러 로그 숨김
      }
    }

    async function loadBingo() {
      try {
        // 빙고 아이템 로드
        const itemsResp = await fetch("/api/bingo/items");
        const allItems = await itemsResp.json();
        
        // 빙고 아이템을 랜덤하게 섞기
        bingoItems = shuffleArray(allItems);
        
        // 플레이어 빙고 로드
        if (currentUUID) {
          const playerResp = await fetch(`/api/bingo/player/${currentUUID}`);
          playerBingo = await playerResp.json();
        }
        
        renderBingoGrid();
      } catch (e) {
        // 에러 로그 숨김
      }
    }
    
    // 배열 랜덤 섞기 함수
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function renderBingoGrid() {
      const grid = document.getElementById("bingoGrid");
      grid.innerHTML = "";
      
      // 선택된 아이템 ID 목록
      const selectedItemIds = new Set(playerBingo.map(pb => pb.bingo_item_id));
      
      // 81개 칸 생성 (랜덤 섞인 순서로)
      for (let i = 0; i < 81; i++) {
        const item = bingoItems[i]; // 랜덤 순서로 배치
        const selected = item && selectedItemIds.has(item.id);
        
        const tierColors = {
          "S+": "#ff48c0",
          "S": "#ffa500",
          "A": "#ffd700",
          "B": "#64c8ff",
          "C": "#9696ff",
          "D": "#c8c8c8"
        };
        
        const color = item ? tierColors[item.tier] : "#666";
        const bgColor = item ? `${color}20` : "#1a1a1a";
        
        const cell = document.createElement("div");
        
        // 기본 스타일 설정
        cell.style.cssText = `
          aspect-ratio: 1;
          border: 2px solid ${selected ? '#f6d58a' : color};
          border-radius: 12px;
          background: ${selected ? `linear-gradient(135deg, ${color}40, ${color}20)` : bgColor};
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 8px;
          transition: all 0.2s ease;
          font-size: 12px;
          text-align: center;
          position: relative;
          user-select: none;
          -webkit-user-select: none;
        `;
        
        // 선택되지 않은 칸은 "?"로 표시
        if (!selected) {
          // 선택 안 된 칸은 항상 "?"
          cell.innerHTML = '<div style="font-size: 24px; opacity: 0.5;">?</div>';
          
          if (item && userPoints >= 3) {
            cell.style.cursor = "pointer";
            cell.style.opacity = "1";
            
            // 클릭 이벤트 (클로저 사용)
            const position = i;
            const itemId = item.id;
            cell.addEventListener("click", () => selectBingoSlot(position, itemId));
            
            // 호버 효과
            cell.addEventListener("mouseenter", () => {
              cell.style.transform = "scale(1.05)";
              cell.style.boxShadow = "0 4px 12px rgba(255,255,255,0.2)";
            });
            cell.addEventListener("mouseleave", () => {
              cell.style.transform = "scale(1)";
              cell.style.boxShadow = "";
            });
          } else {
            cell.style.cursor = "not-allowed";
          }
        } else {
          // 선택된 칸만 보상 표시
          cell.innerHTML = `
            <div style="font-size: 10px; opacity: 0.7;">[${item.tier}]</div>
            <div style="font-size: 11px; font-weight: 700; color: ${color}; margin: 4px 0;">${item.item_name}</div>
            <div style="font-size: 20px;">✅</div>
          `;
          cell.style.cursor = "default";
        }
        
        grid.appendChild(cell);
      }
    }

    async function selectBingoSlot(position, itemId) {
      if (!currentUUID || userPoints < 3) {
        alert("포인트가 부족합니다! (최소 3포인트 필요)");
        return;
      }
      
      if (!confirm("이 칸을 선택하시겠습니까? (3포인트 차감)")) return;
      
      try {
        const resp = await fetch(`/api/bingo/select/${currentUUID}`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({position, item_id: itemId})
        });
        
        if (!resp.ok) {
          const data = await resp.json();
          alert(data.detail || "선택 실패");
          return;
        }
        
        const data = await resp.json();
        userPoints = data.points_remaining;
        document.getElementById("pointsValue").textContent = userPoints;
        
        // 빙고 재로드
        await loadBingo();
        
      } catch (e) {
        alert("오류: " + e.message);
      }
    }

    // 저장된 UUID 로드
    if (localStorage.getItem("mcUUID")) {
      currentUUID = localStorage.getItem("mcUUID");
      document.getElementById("bingoAuth").innerHTML = `
        <h3 style="margin: 0 0 8px; color: var(--gold-2);">✅ ${localStorage.getItem("mcName")}</h3>
        <p style="margin: 0; color: var(--muted); font-size: 14px;">연동됨</p>
      `;
      document.getElementById("pointsInfo").style.display = "block";
      
      // 비동기로 로드
      loadBingo().then(() => loadPoints());
    }

    // ========== 보안: 개발자 도구 차단 ==========
    (function() {
      'use strict';
      
      // 콘솔 오버라이드
      const noop = () => void 0;
      const methods = ['log', 'debug', 'info', 'warn', 'error'];
      methods.forEach(method => {
        window.console[method] = noop;
      });
      
      // 개발자 도구 감지 및 경고
      let devtools = {open: false, orientation: null};
      
      setInterval(() => {
        if (window.outerHeight - window.innerHeight > 200 || 
            window.outerWidth - window.innerWidth > 200) {
          if (!devtools.open) {
            devtools.open = true;
            document.body.style.filter = 'blur(10px)';
            setTimeout(() => {
              document.body.style.filter = '';
            }, 100);
          }
        } else {
          devtools.open = false;
        }
      }, 500);
      
      // F12, Ctrl+Shift+I 등 차단
      document.addEventListener('keydown', (e) => {
        if (e.key === 'F12' || 
           (e.ctrlKey && e.shiftKey && e.key === 'I') ||
           (e.ctrlKey && e.shiftKey && e.key === 'C') ||
           (e.ctrlKey && e.shiftKey && e.key === 'J') ||
           (e.ctrlKey && e.key === 'U')) {
          e.preventDefault();
          return false;
        }
        return true;
      });
      
      // 우클릭 차단
      document.addEventListener('contextmenu', e => e.preventDefault());
      
      // 텍스트 선택 일부 차단
      document.addEventListener('selectstart', e => e.preventDefault());
    })();
    
    // Init
    document.getElementById("year").textContent = (new Date()).getFullYear();
    loadAuth();
    loadList();
    loadBingo();
  </script>
</body>
</html>
