# 🐛 포인트 디버깅 가이드

## 문제: 포인트가 안 올라옴

### 체크리스트

#### 1. 플러그인 작동 확인
```
✅ 서버 로그에서 확인:
```
```
[PointsPlugin] API URL: https://...
[PointsPlugin] 활성화됨!
```

#### 2. 포인트 지급 확인
플레이어가 1분 플레이 후:
```
✅ 서버 콘솔 확인:
[PointsPlugin] PlayerName에게 포인트가 지급되었습니다.
```

#### 3. API 연결 확인
콘솔에 오류 메시지가 있는지 확인:
```
❌ "Can't connect to API" 
❌ "Connection timeout"
❌ "HTTP 401 Unauthorized"
❌ "HTTP 404 Not Found"
```

#### 4. 홈페이지 API 테스트
```bash
curl https://prelaunch-all-in-one.onrender.com/api/health
```

예상 응답:
```json
{"ok": true}
```

---

## 🔍 단계별 확인

### Step 1: 플러그인 활성화 확인

서버 콘솔에서:
```
/plugins
```

`PointsPlugin`이 **초록색**으로 표시되어야 합니다.

---

### Step 2: API URL 확인

서버 로그에서:
```
[PointsPlugin] API URL: https://...
```

이 URL이 올바른지 확인!

---

### Step 3: 플레이어 포인트 확인

게임에서:
```
/pointsp  # 명령어 목록
```

API 호출 테스트:
```bash
# 플레이어 UUID 확인 후
curl https://prelaunch-all-in-one.onrender.com/api/points/{플레이어UUID}
```

예상 응답:
```json
{
  "uuid": "...",
  "points": 0,
  "playtime_minutes": 0
}
```

---

### Step 4: 플러그인 로그 확인

서버 콘솔에서 실시간 로그 확인:
```
[PointsPlugin] PlayerName에게 포인트가 지급되었습니다.  # ✅ 정상
```

또는:
```
[PointsPlugin] 포인트 지급 실패: ...  # ❌ 오류
```

---

## 🚨 자주 발생하는 오류

### 1. SHARED_SECRET 불일치
```
오류: HTTP 401 Unauthorized
```

해결:
- 플러그인 config.yml의 `secret` 확인
- Backend 환경변수의 `SHARED_SECRET` 확인
- 둘이 일치해야 함!

---

### 2. API URL 오류
```
오류: Can't connect to API
Connection timeout
```

해결:
- config.yml의 `api.url` 확인
- URL 끝에 슬래시(/) 없는지 확인
- HTTPS인지 확인

---

### 3. DB 연결 오류
```
오류: Database connection failed
```

해결:
- Render의 DATABASE_URL 확인
- PostgreSQL 연결 확인

---

### 4. 플러그인이 1분 간격으로 실행 안됨

config.yml 확인:
```yaml
points:
  interval_minutes: 1  # 1분으로 변경했는지 확인!
```

플러그인 코드는 **코드 내부가 30분으로 고정**되어 있습니다!

---

## ⚠️ 중요: 플러그인 코드 수정 필요!

플러그인이 하드코딩된 30분으로 되어 있습니다!

`plugin/src/main/java/com/ramjwi/points/PointsPlugin.java` 73번 줄:

```java
// 현재 (30분 고정)
if (currentMinutes - lastCheck >= 30) {
```

이 부분을 config에서 읽어오도록 수정해야 합니다!

---

## 🔧 빠른 테스트

### 1. API 수동 테스트
```bash
# 플러그인 API 직접 호출
curl -X POST https://prelaunch-all-in-one.onrender.com/api/plugin/add-points/{UUID} \
  -H "Content-Type: application/json" \
  -H "X-Prelaunch-Secret: asas1212@@" \
  -d '{"minutes": 1}'
```

예상 응답:
```json
{"ok": true, "total_points": 1, "total_minutes": 1}
```

---

**어떤 단계에서 막히는지 알려주시면 더 정확히 도와드리겠습니다!** 🔍

